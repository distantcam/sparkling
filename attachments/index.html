<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-28399680-2"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-28399680-2")</script><link rel="alternate" type="application/rss+xml" title="Subscribe to What&#39;s New" href="/feed.rss"><meta name="author" content="Cameron MacFarland"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#2d89ef"><meta name="theme-color" content="#ffffff"><title>Attachments - Cam&#39;s Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700"><link rel="stylesheet" href="/css/theme.css"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a><nav class="navbar navbar-expand-md navbar-dark bg-dark"><div class="container px-0"><a class="navbar-brand" href="/">Cam&#39;s Blog</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/tags">Tags</a></li><li class="nav-item"><a class="nav-link" href="/feed.rss"><i class="fas fa-rss fa-lg"></i></a></li></ul></div></div></nav><div id="content"><div class="container mt-5"><div class="row"><main class="col-sm-12 col-md-8"><article><div class="blog-item-wrap"><img class="post-thumbnail" src="https://source.unsplash.com/vJICk89hFbU/750x410"><div class="post-inner-content"><header class="post-header"><h2 class="post-title">Attachments</h2><div class="post-meta"><span class="posted-on"><i class="fas fa-calendar-alt"></i> <time datetime="2012-09-16T16:00:00.000Z">17th September 2012</time> </span><span class="tags ml-2"><i class="fas fa-tags"></i> <a class="tag" href="/tags/architecture/">architecture</a> <a class="tag" href="/tags/mvvm/">mvvm</a></span></div></header><div class="post-content"><p>Where we reach the crazy portion of the program.</p><a id="more"></a><p>One of the biggest problems I’ve seen with any non-trivial MVVM application is that of mega-ViewModels AKA <a href="http://en.wikipedia.org/wiki/God_object" target="_blank" rel="noopener">God objects</a>. And it’s not just me. Many people have the same problem.</p><p><a href="http://stackoverflow.com/questions/2951301/mvvm-and-avoiding-monolithic-god-object" target="_blank" rel="noopener">MVVM and avoiding Monolithic God object on StackOverflow</a></p><h2 id="DataContext-and-the-Lone-ViewModel"><a href="#DataContext-and-the-Lone-ViewModel" class="headerlink" title="DataContext and the Lone ViewModel"></a>DataContext and the Lone ViewModel</h2><p>Why is it that we only have one ViewModel per View? Well for the whole thing to work the ViewModel must be assigned to the DataContext of the View. This necessitates a one View - one ViewModel idea.</p><p>ViewModels must handle lots of different things. Sometimes they are data entry, needing access to the data store and maybe some validation routines. Sometimes they are navigation waypoints, allowing the user to create a new document, open an existing one, or open some other part of the application.</p><p>This idea leads to ViewModels doing way more than they should. For <a href="http://en.wikipedia.org/wiki/Cross-cutting_concern" target="_blank" rel="noopener">cross-cutting concerns</a> the standard approach is to use a service, which is just a class in your IoC that can be passed into your ViewModel. This works great for things like MessageBoxes, standard Open/Save/Print dialogs, etc.</p><p>This leaves concerns that are ViewModel specific, but may not be related to each other. Usually this causes the ViewModel to violate the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle" target="_blank" rel="noopener">single responsibility principle</a> by implementing multiple concerns in the same class.</p><h2 id="Attached-Behaviours"><a href="#Attached-Behaviours" class="headerlink" title="Attached Behaviours"></a>Attached Behaviours</h2><p>In his <a href="http://blogs.msdn.com/b/johngossman/archive/2008/05/07/the-attached-behavior-pattern.aspx" target="_blank" rel="noopener">blog entry</a> on Attached Behaviours John Gossman has this to say.</p><blockquote><p>The Attached Behavior pattern encapsulates “behavior” (usually user interactivity) into a class outside the visual heirarchy and allows it to be applied to a visual element by setting an attached property and hooking various events on the visual element.</p></blockquote><p>Attached behaviours are an implementation of the <a href="http://en.wikipedia.org/wiki/Decorator_pattern" target="_blank" rel="noopener">decorator pattern</a> which allows you to separate behaviours or concerns into a discrete class and attach to the visual element.</p><p>So what if we treated the ViewModel as just a specialized storage for the View, like a ViewBag in ASP.net MVC, and put all the behaviours of the ViewModel into an attachment that we expose through the ViewModel via public properties?</p><p>What if our ViewModel was just a bunch of public properties?</p><p>What if we used some sort of attachment to add behaviour to that ViewModel?</p><h2 id="Attachments-to-ViewModels"><a href="#Attachments-to-ViewModels" class="headerlink" title="Attachments to ViewModels"></a>Attachments to ViewModels</h2><p>A ViewModel can have multiple attachments, each fulfilling a specific purpose. An attachment can set up initial values for properties, and assign ICommands for the ViewModel.</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">interface</span> <span class="token class-name">IAttachment</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">AttachTo</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Attachment</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">:</span> IAttachment <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> T viewModel<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">OnAttach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> IAttachment<span class="token punctuation">.</span><span class="token function">AttachTo</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        viewModel <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>obj<span class="token punctuation">;</span>
        <span class="token function">OnAttach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SampleAttachment</span> <span class="token punctuation">:</span> Attachment<span class="token operator">&lt;</span>SampleViewModel<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">OnAttach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ... set up properties in the view model</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SampleViewModel</span> <span class="token punctuation">:</span> ViewModelBase <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> SomeProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    pubic ICommand DoSomething <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Setting up an attachment is pretty straightforward. You can simply call the attachment from the constructor of the ViewModel itself. A better option however is to use your IoC to automate the attachment process. Here’s an example of how to do this in Autofac.</p><pre class="line-numbers language-csharp"><code class="language-csharp"><span class="token keyword">class</span> <span class="token class-name">AutoAttachmentModule</span> <span class="token punctuation">:</span> Module <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">AttachToComponentRegistration</span><span class="token punctuation">(</span>
        IComponentRegistry componentRegistry<span class="token punctuation">,</span> 
        IComponentRegistration registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registration<span class="token punctuation">.</span>Activating <span class="token operator">+</span><span class="token operator">=</span> Activating<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">Activating</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> ActivatingEventArgs<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token operator">></span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> vmType <span class="token operator">=</span> e<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Convention to find attachments from a ViewModel</span>
        <span class="token comment" spellcheck="true">// This can be done better.</span>
        <span class="token keyword">var</span> attachmentType <span class="token operator">=</span> Type<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span>
            vmType<span class="token punctuation">.</span>FullName<span class="token punctuation">.</span><span class="token function">ReplaceAll</span><span class="token punctuation">(</span><span class="token string">"ViewModel"</span><span class="token punctuation">,</span> <span class="token string">"Attachment"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>attachmentType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> 
            <span class="token operator">!</span>e<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">IsRegistered</span><span class="token punctuation">(</span>attachmentType<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> attachment <span class="token operator">=</span> <span class="token punctuation">(</span>IAttachment<span class="token punctuation">)</span>e<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>attachmentType<span class="token punctuation">)</span><span class="token punctuation">;</span>

        attachment<span class="token punctuation">.</span><span class="token function">AttachTo</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Attachments allows for the separation of parts of of a ViewModel that cannot otherwise be broken up with sub-ViewModels.</p><p>We can test the View-ViewModel binding without worrying about triggering an interaction in the ViewModel’s implementation.</p><p>We can also test the ViewModel-Attachment interaction without worrying about whether our bindings are correct. And with each logical part being in a separate Attachment we can test them in isolation without side-effect.</p></div></div></div></article><div id="comments"><h2 class="text-primary">x thoughts on “Attachments”</h2><ol class="comment-list"><li><div id="reply-0" class="comment-body"><div class="comment-meta"><div class="comment-author"><img width="60" height="60" src="https://www.gravatar.com/avatar/0d113e963c796ec77c7ed883e490316d?s=60&d=mp&r=g"> <b class="text-uppercase">Test Author</b></div><div class="comment-metadata"><time datetime="2019-02-24T13:12:07.979Z">24th February 2019 at 21:12:07</time></div></div><div class="comment-content"><p>Some comment</p></div><div class="reply text-right"><button class="reply btn btn-light-primary btn-sm" data-respondtarget="reply-0">Reply</button></div></div><ol class="children"><li><div id="reply-1" class="comment-body"><div class="comment-meta"><div class="comment-author"><img width="60" height="60" src="https://www.gravatar.com/avatar/2f5b3fa26595bc45871213860db4668f?s=60&d=mp&r=g"> <b class="text-uppercase">Anon User</b></div><div class="comment-metadata"><time datetime="2019-02-24T13:12:07.979Z">24th February 2019 at 21:12:07</time></div></div><div class="comment-content"><p>Anonymous reply</p></div><div class="reply text-right"><button class="reply btn btn-light-primary btn-sm" data-respondtarget="reply-1">Reply</button></div></div><ol class="children"><li><div id="reply-2" class="comment-body"><div class="comment-meta"><div class="comment-author"><img width="60" height="60" src="https://www.gravatar.com/avatar/2f5b3fa26595bc45871213860db4668f?s=60&d=mp&r=g"> <b class="text-uppercase">Anon User</b></div><div class="comment-metadata"><time datetime="2019-02-24T13:12:07.979Z">24th February 2019 at 21:12:07</time></div></div><div class="comment-content"><p>Third reply</p></div><div class="reply text-right"><button class="reply btn btn-light-primary btn-sm" data-respondtarget="reply-2">Reply</button></div></div></li></ol></li></ol></li><li><div id="reply-3" class="comment-body"><div class="comment-meta"><div class="comment-author"><img width="60" height="60" src="https://www.gravatar.com/avatar/0d113e963c796ec77c7ed883e490316d?s=60&d=mp&r=g"> <b class="text-uppercase">Test Author</b></div><div class="comment-metadata"><time datetime="2019-02-24T13:12:07.980Z">24th February 2019 at 21:12:07</time></div></div><div class="comment-content"><p>Some comment</p></div><div class="reply text-right"><button class="reply btn btn-light-primary btn-sm" data-respondtarget="reply-3">Reply</button></div></div></li></ol><div id="respond" class="comment-respond mb-4"><h6 class="text-uppercase text-primary">Leave a reply <small><a id="cancel-reply" href>Cancel reply</a></small></h6><form><small class="text-muted">Your email address will not be published. Required fields are marked <span class="text-primary">*</span></small> <input type="hidden" name="postId" value="attachments"><div class="form-group mt-2"><label for="inputComment">Comment</label> <textarea class="form-control" id="inputComment" rows="5"></textarea></div><div class="form-group mt-2"><label for="inputName">Name <span class="text-primary">*</span></label> <input type="name" class="form-control" id="inputName" aria-describedby="emailHelp" placeholder="required"></div><div class="form-group mt-2"><label for="inputEmail">Email <span class="text-primary">*</span></label> <input type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp" placeholder="required"></div><button type="submit" class="btn btn-primary btn-sm text-uppercase">Post Comment</button></form></div></div></main><div class="col-sm-12 col-md-4"><div class="border bg-white p-4"><aside class="mb-5"><h6 class="text-uppercase">Follow us</h6><ul class="social-items"><li><a href="https://twitter.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://github.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://instagram.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-instagram fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://stackoverflow.com/users/3820"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://mastodon.social/@distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul></aside><aside class="mb-5"><h6 class="text-uppercase">Tags</h6><div class="mt-4"><a class="btn btn-light-primary btn-sm tag" href="/tags/architecture/">architecture</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/mvvm/">mvvm</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/fody/">fody</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/aop/">aop</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/akavache/">akavache</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/etag/">etag</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/web/">web</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/cache/">cache</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/life/">life</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/c/">c#</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/language/">language</a> <a class="btn btn-light-primary btn-sm tag" href="/tags/roslyn/">roslyn</a></div></aside></div></div></div></div></div><div class="scrolltop"><i class="fas fa-arrow-up"></i><span class="sr-only">Scroll to Top</span></div><footer><div class="container text-center"><ul class="social-items social-items-dark"><li><a href="https://twitter.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://github.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://instagram.com/distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-instagram fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://stackoverflow.com/users/3820"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://mastodon.social/@distantcam"><span class="fa-stack fa-lg"><i class="fas fa-square fa-stack-2x"></i> <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="text-muted">Copyright &copy; Cameron MacFarland 2012-2019</p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script><script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script><script src="/js/theme.js"></script></body></html>